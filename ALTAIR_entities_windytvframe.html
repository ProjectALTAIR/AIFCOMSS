<!DOCTYPE html>
<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/leaflet.js"></script>
    <script src="https://cdn.rawgit.com/Leaflet/Leaflet.label/0.8/dist/leaflet.label.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <style type="text/css">
      #windyty {
                 width: 100%;
                 height: 314px;
               }
      .labeltext { width: 400px; }
    </style>
  </head>
  <body>
    <div id="windyty"></div>

    <script type="text/javascript">

    var windytyInit = {
          // Required: API key
          key: 'fJAcjkGrbADMg2t',

          // Optional: Initial state of the map
//          lat: 50.4,
//          lon: 14.3,
//          lat: ALTAIRLat,
//          lon: ALTAIRLon,
          lat:   48.46,
          lon: -123.31,
          zoom: 14,
          minZoom: 0,
          maxZoom: 18
/*
          layers: [
            L.tileLayer('http://{s}.tile.cloudmade.com/{key}/997/256/{z}/{x}/{y}.png', {
              maxZoom: 13,
              minZoom: 0,
              attribution: 'Map data &copy; 2011 OpenStreetMap contributors, Imagery &copy; 2011 CloudMade',
              key: 'BC9A493B41014CAABB98F0471D759707'
            }),
            L.tileLayer('http://server.arcgisonline.com/ArcGIS/' + 'rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
              minZoom: 14,
              maxZoom: 18,
              attribution: 'Tiles Â© Esri - '
                           + 'Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, '
                           + 'Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'})
          ]
*/
      };

    // Required: Windyty main function is called after
    // initialization of API
    //
    // @map is instance of Leaflet maps
    //
    function windytyMain(map) {
      var aLTAIRLatInput = window.parent.p5frame.document.getElementById('gLTAIRLat');
      var aLTAIRLonInput = window.parent.p5frame.document.getElementById('gLTAIRLon');
      var aLTAIRAltInput = window.parent.p5frame.document.getElementById('gLTAIRAlt');
      var aLTAIRTerInput = window.parent.cesiumframe.document.getElementById('terrHeight');
      var ALTAIRLat      = parseFloat(aLTAIRLatInput.value);
      var ALTAIRLon      = parseFloat(aLTAIRLonInput.value);
      var ALTAIRTer      = parseFloat(aLTAIRTerInput.value);
      var ALTAIRAlt      = aLTAIRAltInput.value;
      var roundALTAIRAlt = Math.round(ALTAIRAlt);
      var roundALTAIRTer = Math.round(ALTAIRTer);

      var ALTAIRAltText  = 'ALTAIR&nbsp;=&nbsp;' + roundALTAIRAlt + '&nbsp;m&nbsp;ASL<br>Terrain&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;' + roundALTAIRTer +'&nbsp;m&nbsp;ASL';

/*
      L.tileLayer('http://tiles.mapc.org/basemap/{z}/{x}/{y}.png', {
        attribution: 'Tiles by <a href="http://mapc.org">MAPC</a>, Data by <a href="http://mass.gov/mgis">MassGIS</a>',
        maxZoom: 17,
        minZoom: 9
      }).addTo(map);
      L.tileLayer('http://server.arcgisonline.com/ArcGIS/' + 'rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, ',
        maxZoom: 17,
        minZoom: 11
      }).addTo(map);
*/
      L.tileLayer('http://b.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, ',
        maxZoom: 17,
        minZoom: 12
      }).addTo(map);
		
		
		
		new L.Control.Zoom({ position: 'topleft' }).addTo(map);
//      
//      
//      map.remove();
//      var tooltip = L.tooltip("hi");
//      map.zoomControl.setPosition('topleft');
      var marker = L.marker([ALTAIRLat, ALTAIRLon])
        .bindLabel(ALTAIRAltText, { noHide: true, offset: [20,-40] })
//        .setOpacity( 0.65 )
//        .bindTooltip("hi")
        .addTo( map );
      marker.setOpacity( 0.65 );

      map.panTo([ALTAIRLat, ALTAIRLon]);

      window.setTimeout(function() {
        marker.remove();
        windytyMain(map);
      }, 5000);
    }
	
	//Since we dont have access to all the leaflet setup commands, we need to switch after it has loaded.
	//There isn't a well defined event that we can listen for, but 2 seconds after the ready of that element seems to work
	$('.leaflet-control-zoom').ready( function() {
		setTimeout(removeZoomPosition, 4000);
	});
	
	// Takes the content from the top left corner div and places it in the top right corner
	function removeZoomPosition() {
		//$('.leaflet-top.leaflet-left').html($('.leaflet-top.leaflet-right').html());
		$('.leaflet-top.leaflet-right').html('');
	}
	
    </script>

    <script async defer src="https://api.windytv.com/v2.3/boot.js"></script>
  </body>
</html>
